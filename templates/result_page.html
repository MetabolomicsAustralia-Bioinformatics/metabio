
{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css'%} ">
    <link rel="stylesheet" href="{% static 'css/bootstrap-grid.min.css' %}">
    <link rel="stylesheet" href="//cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="{% static 'css/result_page.css' %}">
    <link href="https://fonts.googleapis.com/css?family=PT+Serif" rel="stylesheet">
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css">-->
    <!--<link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/dataTables.semanticui.min.css">-->
    <meta charset="UTF-8">
    <script type="text/javascript" src="../static/js/echarts.js"></script>
    <script type="text/javascript" src="../static/js/jquery-3.2.1.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js"></script>-->
    <!--<script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/dataTables.semanticui.min.js"></script>-->


    <title>Result</title>
</head>
<body style="font-family: 'PT Serif, serif'">
<select id="algorithm" class="custom-select">
    <option value="IS Normalisation" selected="selected">IS Normalisation</option>
    <option value="IS + Reagent Blank Subtraction">IS + Reagent Blank Subtraction</option>
    <option value="IS + Reagent Blank Subtraction + Concentration">IS + Reagent Blank Subtraction + Concentration</option>
</select>


<table id="table" class="cell-border" width="100%"></table>
<form name="download_result" method="post" action="../download/">
    {% csrf_token %}
    <input type="text" name="download_result" value="download_result"  style="display: none">
    <input type="text" id="selected_input" name="selected" value="download_sample" style="display: none">
    <input type="text" id="json_pk_input" name="input_json_pk" value="download_sample" style="display: none">
    <input type="text" id="offset_input" name="offset" value="download_sample" style="display: none">
    <input type="text" id="is_nor" name="is_nor" value="is_nor" style="display: none">
    <input type="submit" value="download result file" class="btn btn-outline-danger">
</form>

<script type="text/javascript">
    $(function() {
        var result_data = JSON.parse(window.sessionStorage.getItem("result_data"));
        var selected = JSON.parse(window.sessionStorage.getItem("selected"));
        var input_json_pk = JSON.parse(window.sessionStorage.getItem("input_json_pk"));
        var offset = JSON.parse(window.sessionStorage.getItem('offset'));
        var algorithm = $('#algorithm').val();
        var is_nor = JSON.parse(window.sessionStorage.getItem('is_nor'));
        draw_table(algorithm, result_data);

        $('#selected_input').val(JSON.stringify(selected));
        $('#json_pk_input').val(input_json_pk);
        $('#offset_input').val(offset);
        $('#is_nor').val(is_nor);


        $('#algorithm').on('change', function() {
            algorithm = $(this).val();
            $('#table').DataTable().destroy();
            //$('#table').DataTable().clear();
            draw_table(algorithm, result_data);
        });
    });

    function get_length(obj) {
        var size = 0;
        for (key in obj) {
            if (obj.hasOwnProperty(key)) {
                size ++;
            }
        }
        return size;
    }


    function draw_table(algorithm, originData) {
        var table_data;
        if (algorithm == 'IS Normalisation') {
            table_data = originData[1];
        }
        if (algorithm == 'IS + Reagent Blank Subtraction') {
            table_data = originData[3];
        }
        if (algorithm == 'IS + Reagent Blank Subtraction + Concentration') {
            table_data = originData[5];
        }
        var table_data_array = json_data_to_array(table_data);
        var heads = table_data['heads'];
        var columns = [];
        for (var i = 0; i < heads.length; i++) {
            columns.push({title: heads[i]});
        }

        $('#table').DataTable({
            data: table_data_array,
            columns: columns,
            destroy: true,
            ordering: false,
            searching: false,
            paging: false,
        });

    }

    function json_data_to_array(table_data) {
        var res = [];
        for (var i = 0; i < table_data['ID'].length; i++) {
            var tmp = [];
            for (var each in table_data) {
                if (each != 'heads') {
                    tmp.push(table_data[each][i]);
                }
            }
            res.push(tmp);
        }
        return res;
    }




</script>
</body>
</html>